<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Envelope Calculator</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="description" content="App per calcolare le misure per envelope punch board">
  <meta name="theme-color" content="#3B82F6">
</head>
<body>
  <div id="root">
    <div style="display:flex;justify-content:center;align-items:center;height:100vh;font-family:Arial,sans-serif;">
      <div>Caricamento...</div>
    </div>
  </div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    /* ---------- Icone ---------- */
    const Calculator = ({ size=24, className="" }) =>
      React.createElement('svg',{className,width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},[
        React.createElement('rect',{key:'1',width:"16",height:"20",x:"4",y:"2",rx:"2"}),
        React.createElement('line',{key:'2',x1:"8",x2:"16",y1:"6",y2:"6"}),
        React.createElement('line',{key:'3',x1:"16",x2:"16",y1:"14",y2:"18"}),
        React.createElement('path',{key:'4',d:"m16 10-4-4-4 4"})
      ]);
    const Ruler = ({ size=24, className="" }) =>
      React.createElement('svg',{className,width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},[
        React.createElement('path',{key:'1',d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z"}),
        React.createElement('path',{key:'2',d:"m14.5 12.5 2-2"}),
        React.createElement('path',{key:'3',d:"m11.5 9.5 2-2"}),
        React.createElement('path',{key:'4',d:"m8.5 6.5 2-2"}),
        React.createElement('path',{key:'5',d:"m17.5 15.5 2-2"})
      ]);
    const Mail = ({ size=24, className="" }) =>
      React.createElement('svg',{className,width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},[
        React.createElement('rect',{key:'1',width:"20",height:"16",x:"2",y:"4",rx:"2"}),
        React.createElement('path',{key:'2',d:"m22 7-10 5L2 7"})
      ]);

    /* ---------- Util ---------- */
    const CM_PER_IN = 2.54;

    const toInches = (value, unit) => {
      const n = Number(value);
      if (!isFinite(n)) return NaN;
      return unit === 'in' ? n : n / CM_PER_IN;
    };
    const fromInches = (valueInInches, unit) => {
      const n = Number(valueInInches);
      if (!isFinite(n)) return NaN;
      return unit === 'in' ? n : n * CM_PER_IN;
    };
    const fmt = (n, unit) => {
      if (!isFinite(n)) return '';
      // più “fine” in pollici, più “comodo” in cm
      return unit === 'in' ? n.toFixed(2) : n.toFixed(1);
    };
    const convertUnitsValue = (value, fromUnit, toUnit) => {
      if (!isFinite(Number(value))) return '';
      const inches = toInches(value, fromUnit);
      return fmt(fromInches(inches, toUnit), toUnit);
    };

    const EnvelopeCalculator = () => {
      const [cardWidth, setCardWidth]   = useState('');  // nel'unità corrente
      const [cardHeight, setCardHeight] = useState('');
      const [unit, setUnit] = useState('cm');            // 'cm' | 'in'
      const [results, setResults] = useState(null);

      // calcolo con offset definiti in POLLICI (coerenti con le board)
      const calculateEnvelope = () => {
        const wIn = toInches(cardWidth, unit);
        const hIn = toInches(cardHeight, unit);
        if (!isFinite(wIn) || !isFinite(hIn) || wIn <= 0 || hIn <= 0) {
          setResults(null);
          return;
        }

        // ---- LOGICA ESISTENTE (placeholders), ma in pollici ----
        const paperWidthIn  = wIn + 0.5;   // +1/2"
        const paperHeightIn = hIn + 1.0;   // +1"
        const scoreWidthIn  = wIn + 0.25;  // +1/4"
        const scoreHeightIn = hIn + 0.25;  // +1/4"

        // Conversione verso l'unità selezionata SOLO in uscita
        const paperWidthOut  = fromInches(paperWidthIn, unit);
        const paperHeightOut = fromInches(paperHeightIn, unit);
        const scoreWidthOut  = fromInches(scoreWidthIn, unit);
        const scoreHeightOut = fromInches(scoreHeightIn, unit);

        setResults({
          paperWidth:  fmt(paperWidthOut,  unit),
          paperHeight: fmt(paperHeightOut, unit),
          scoreWidth:  fmt(scoreWidthOut,  unit),
          scoreHeight: fmt(scoreHeightOut, unit),
          unit
        });
      };

      useEffect(() => {
        calculateEnvelope();
      }, [cardWidth, cardHeight, unit]);

      // quando cambio unità, converto ANCHE gli input mostrati
      const handleUnitChange = (nextUnit) => {
        if (nextUnit === unit) return;
        const newW = convertUnitsValue(cardWidth || '0', unit, nextUnit);
        const newH = convertUnitsValue(cardHeight || '0', unit, nextUnit);
        setUnit(nextUnit);
        // aggiorno i campi una volta cambiata l'unità
        setCardWidth(newW || '');
        setCardHeight(newH || '');
      };

      return (
        <div className="max-w-md mx-auto bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen p-4">
          <div className="bg-white rounded-xl shadow-lg p-6 mt-8">
            {/* Header */}
            <div className="text-center mb-6">
              <div className="bg-blue-100 rounded-full p-3 w-16 h-16 mx-auto mb-3 flex items-center justify-center">
                <Mail size={32} className="text-blue-600" />
              </div>
              <h1 className="text-2xl font-bold text-gray-800">Envelope Calculator</h1>
              <p className="text-gray-600 text-sm mt-1">Calcola le misure per envelope punch board</p>
            </div>

            {/* Units */}
            <div className="mb-4">
              <label className="block text-sm font-medium text-gray-700 mb-2">Unità di misura</label>
              <div className="flex rounded-lg border border-gray-200 overflow-hidden">
                <button
                  onClick={() => handleUnitChange('cm')}
                  className={`flex-1 py-2 px-4 text-sm font-medium ${unit==='cm'?'bg-blue-600 text-white':'bg-white text-gray-700 hover:bg-gray-50'}`}
                >Centimetri</button>
                <button
                  onClick={() => handleUnitChange('in')}
                  className={`flex-1 py-2 px-4 text-sm font-medium ${unit==='in'?'bg-blue-600 text-white':'bg-white text-gray-700 hover:bg-gray-50'}`}
                >Pollici</button>
              </div>
            </div>

            {/* Inputs */}
            <div className="bg-gray-50 rounded-lg p-4">
              <h3 className="font-semibold text-gray-800 mb-3 flex items-center">
                <Ruler className="mr-2" size={18}/> Card Size
              </h3>
              <div className="grid grid-cols-2 gap-3">
                <div>
                  <label className="block text-sm text-gray-600 mb-1">Larghezza</label>
                  <input
                    type="number"
                    step={unit==='in' ? '0.01' : '0.1'}
                    value={cardWidth}
                    onChange={(e)=>setCardWidth(e.target.value)}
                    className="w-full px-3 py-2 border border-gray-200 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    placeholder="0.0"
                  />
                  <span className="text-xs text-gray-500">{unit}</span>
                </div>
                <div>
                  <label className="block text-sm text-gray-600 mb-1">Altezza</label>
                  <input
                    type="number"
                    step={unit==='in' ? '0.01' : '0.1'}
                    value={cardHeight}
                    onChange={(e)=>setCardHeight(e.target.value)}
                    className="w-full px-3 py-2 border border-gray-200 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    placeholder="0.0"
                  />
                  <span className="text-xs text-gray-500">{unit}</span>
                </div>
              </div>
            </div>

            {/* Risultati */}
            {results && (
              <div className="bg-green-50 rounded-lg p-4 border border-green-200 mt-4">
                <h3 className="font-semibold text-green-800 mb-3 flex items-center">
                  <Calculator className="mr-2" size={18}/> Risultati
                </h3>

                {/* Paper Size */}
                <div className="bg-white rounded-md p-3 mb-3">
                  <h4 className="font-medium text-gray-800 mb-2">Paper Size</h4>
                  <div className="grid grid-cols-2 gap-2 text-sm">
                    <div>
                      <span className="text-gray-600">Larghezza:</span>
                      <div className="font-semibold">{results.paperWidth} {results.unit}</div>
                      <div className="text-xs text-gray-500">
                        ({convertUnitsValue(results.paperWidth, results.unit, results.unit==='cm'?'in':'cm')} {results.unit==='cm'?'in':'cm'})
                      </div>
                    </div>
                    <div>
                      <span className="text-gray-600">Altezza:</span>
                      <div className="font-semibold">{results.paperHeight} {results.unit}</div>
                      <div className="text-xs text-gray-500">
                        ({convertUnitsValue(results.paperHeight, results.unit, results.unit==='cm'?'in':'cm')} {results.unit==='cm'?'in':'cm'})
                      </div>
                    </div>
                  </div>
                </div>

                {/* Score Lines */}
                <div className="bg-white rounded-md p-3">
                  <h4 className="font-medium text-gray-800 mb-2">Score Lines</h4>
                  <div className="grid grid-cols-2 gap-2 text-sm">
                    <div>
                      <span className="text-gray-600">Larghezza:</span>
                      <div className="font-semibold">{results.scoreWidth} {results.unit}</div>
                      <div className="text-xs text-gray-500">
                        ({convertUnitsValue(results.scoreWidth, results.unit, results.unit==='cm'?'in':'cm')} {results.unit==='cm'?'in':'cm'})
                      </div>
                    </div>
                    <div>
                      <span className="text-gray-600">Altezza:</span>
                      <div className="font-semibold">{results.scoreHeight} {results.unit}</div>
                      <div className="text-xs text-gray-500">
                        ({convertUnitsValue(results.scoreHeight, results.unit, results.unit==='cm'?'in':'cm')} {results.unit==='cm'?'in':'cm'})
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            )}

            {/* Nota */}
            <div className="mt-6 p-3 bg-blue-50 rounded-lg">
              <p className="text-xs text-blue-700">
                <strong>Nota: </strong>
                il cambio unità ora converte anche i valori inseriti e le misure calcolate.
                La logica di calcolo delle misure è volutamente invariata (placeholder).
              </p>
            </div>
          </div>
        </div>
      );
    };

    // montaggio app
    ReactDOM.render(React.createElement(EnvelopeCalculator), document.getElementById('root'));
  </script>
</body>
</html>
